steps:
- task: SonarQubePrepare@5
  inputs:
    SonarQube: 'SonarQube'  # service connection name
    scannerMode: 'Other'
    extraProperties: 'sonar.projectKey=ivi-example-app'
  displayName: Prepare

- template: gradle/gradle.yml@devops-templates
  parameters:
    tasks: >-
      sonarqube
    projectOptions: >-
      -PiviVersion=$(product_version)
      -PartifactoryBaseUrl=$(artifactoryBaseUrl)
      -PartifactoryUser=$(artifactoryUser)
      -PartifactoryToken=$(artifactoryToken)
    displayName: Analyze

- task: SonarQubePublish@5
  inputs:
    pollingTimeoutSec: '300'
  displayName: Publish

- template: mixer/notify-mixer.yml@devops-templates
  parameters:
    projectComponentUnit: 'PU AS'
    projectComponentName: 'TomTom Digital Cockpit'
    projectComponentVersion: $(product_version)
    scanToolName: 'SONARQUBE'
    scanType: 'SAST'
    projectnameInTool: 'IVI_Examples'
    versionnameInTool: $(product_version)
    condition: and(eq(variables.isMainlineBuild, true), succeeded())
