# Copyright Â© 2020 TomTom NV. All rights reserved.
#
# This software is the proprietary copyright of TomTom NV and its subsidiaries and may be
# used for internal evaluation purposes or commercial use strictly subject to separate
# license agreement between you and TomTom NV. If you are the licensee, you are only permitted
# to use this software in accordance with the terms of your license agreement. If you are
# not the licensee, you are not authorized to use this software in any manner and should
# immediately return or destroy it.

# Azure pipelines documentation is available at
# https://aka.ms/yaml

parameters:
  # Remote branch to check out
  branch: ''
  # Extra arguments to pass for a lint check, e.g. '--console=plain'
  extraLintParameters: ''

steps:
- template: checkout-branch.yml
  parameters:
    branch: ${{parameters.branch}}

- template: gradle/gradle.yml@devops-templates
  parameters:
    tasks: >-
      lint
    projectOptions:
      ${{parameters.extraLintParameters}}
      -PiviVersion=$(product_version)
    displayName: 'Run linters'
    condition: succeeded()

- template: publish/publish-pipeline-artifact.yml@devops-templates
  parameters:
    contents: |
      **/build/reports/lint/report.xml
    displayName: 'Publish lint reports'
    artifact: lint-reports

- template: gradle/gradle.yml@devops-templates
  parameters:
    tasks: >-
      assemble
    projectOptions: >-
      -PiviVersion=$(product_version)
    displayName: 'Assemble APKs'
    condition: succeeded()

# We only publish the debug version of the template app.
- template: publish/publish-pipeline-artifact.yml@devops-templates
  parameters:
    contents: |
      $(System.DefaultWorkingDirectory)/template/app/build/outputs/apk/debug/*.apk
    displayName: 'Publish Example App APKs as pipeline artifact'
    artifact: builds

