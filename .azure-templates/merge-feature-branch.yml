# Copyright (c) 2020 - 2021 TomTom N.V. All rights reserved.
#
# This software is the proprietary copyright of TomTom N.V. and its subsidiaries and may be
# used for internal evaluation purposes or commercial use strictly subject to separate
# licensee agreement between you and TomTom. If you are the licensee, you are only permitted
# to use this Software in accordance with the terms of your license agreement. If you are
# not the licensee then you are not authorised to use this software in any manner and should
# immediately return it to TomTom N.V.

# Azure pipelines documentation is available at
# https://aka.ms/yaml

parameters:
  # Remote branch to merge
  branch: ''

steps:
  - bash: |
      set -eux
      if [[ -z "${{parameters.branch}}" ]] || [[ "${{parameters.branch}}" == "master" ]] || [[ "${{parameters.branch}}" == release* ]]
      then
        echo "Parameter branch=${{parameters.branch}} not allowed."
        exit 1
      fi
    displayName: 'Check job parameters'

  - checkout: self
    persistCredentials: true
    clean: true

  - bash: |
      set -eux
      git checkout ${{parameters.branch}}
      git push origin ${{parameters.branch}}:$(Build.SourceBranchName)
    displayName: 'Push ${{parameters.branch}} to origin/$(Build.SourceBranchName)'

  - bash: |
      set -eux
      git checkout $(Build.SourceBranchName)
      git branch -D ${{parameters.branch}}
    displayName: 'Clean up local branch'
    condition: always()
