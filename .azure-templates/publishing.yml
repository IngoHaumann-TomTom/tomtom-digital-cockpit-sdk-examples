# Copyright (c) 2020 - 2021 TomTom N.V. All rights reserved.
#
# This software is the proprietary copyright of TomTom N.V. and its subsidiaries and may be
# used for internal evaluation purposes or commercial use strictly subject to separate
# licensee agreement between you and TomTom. If you are the licensee, you are only permitted
# to use this Software in accordance with the terms of your license agreement. If you are
# not the licensee then you are not authorised to use this software in any manner and should
# immediately return it to TomTom N.V.

# Azure pipelines documentation is available at
# https://aka.ms/yaml

steps:
- checkout: self
  persistCredentials: true

# Retrieve the current product version into the $(semver) variable.
- template: product-get-version.yml

- download: current
  artifact: builds

- template: gradle/gradle.yml@devops-templates
  parameters:
    tasks: >-
      artifactoryPublish
      -PpublishUsername=$(ARTIFACTORY_USERNAME)
      -PpublishPassword=$(ARTIFACTORY_PASSWORD)
    displayName: Publish APKs to Artifactory
    condition: succeeded()

- bash: |
    set -eu
    git config --global user.email "ivi_dev@groups.tomtom.com"
    git config --global user.name "Azure DevOps"
    echo "Tagging commit with $(versionInfo.semver)"
    git tag "$(versionInfo.semver)"
    git push origin "$(versionInfo.semver)"
  displayName: Tag commit
  condition: succeeded()
