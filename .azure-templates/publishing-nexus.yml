# Copyright (c) 2020 - 2021 TomTom N.V. All rights reserved.
#
# This software is the proprietary copyright of TomTom N.V. and its subsidiaries and may be
# used for internal evaluation purposes or commercial use strictly subject to separate
# licensee agreement between you and TomTom. If you are the licensee, you are only permitted
# to use this Software in accordance with the terms of your license agreement. If you are
# not the licensee then you are not authorised to use this software in any manner and should
# immediately return it to TomTom N.V.

# Azure pipelines documentation is available at
# https://aka.ms/yaml

steps:
  - checkout: ivi-example-app
  - checkout: indigoqa
  - checkout: indigo

  - bash: |
      set -eux
      mkdir $(Build.SourcesDirectory)/downloads
    displayName: Create download directory

    # Download artifacts from Artifactory by providing the version of the artifact, and publish
    # these to Nexus. The values of the parameters below can be entered from the pipeline's UI.
  - task: PythonScript@0
    name: Nexus
    displayName: Publish artifacts to Nexus
    inputs:
      scriptSource: 'filePath'
      scriptPath: $(Build.SourcesDirectory)/indigo-qa/tooling/Sdk/indigo.py
      pythonInterpreter: /usr/bin/python3.8
      arguments:
        --nexus_user $(NEXUS_USERNAME)
        --nexus_pass $(NEXUS_PASSWORD)
        --artifactory_user $(ARTIFACTORY_USERNAME)
        --artifactory_pass $(ARTIFACTORY_PASSWORD)
        --version_examples $(VERSION_EXAMPLES)
        --version_lineageos $(VERSION_LINEAGEOS)
        --download_base_path $(System.DefaultWorkingDirectory)/downloads
        --indigo_sources_path $(Build.SourcesDirectory)/indigo

  # TODO(IVI-3803): Upload the repo-sys-img.xml file to the developer portal
  - publish: $(Build.SourcesDirectory)/downloads/com/tomtom/ivi/ivi-automotive-sdk/android-11/repo-sys-img.xml
    artifact: repo-sys-img
    displayName: Publish the repo-sys-img.xml file as pipeline artifact
